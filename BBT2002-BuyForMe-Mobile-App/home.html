<!DOCTYPE HTML>
<html>

<head>
    <title>BuyForMe</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" href="js/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/jquery.mobile.datepicker.css" />
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/jquery.ui.datepicker.js"></script>
    <script id="mobile-datepicker" src="js/jquery.mobile.datepicker.js"></script>
    <script src="common.js"></script>
    <script>

	//gets a list of r/s using the getrelationship.php web service
		   /* function getItem() {
		        var xmlhttp = new XMLHttpRequest();
		        var url = serverURL() + "/listitemsbyuser.php";
		
		        xmlhttp.onreadystatechange = function() {
		            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                getRelationshipsResult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
			
    		//add r/s retrieved from getrelationship.php i <select> menu
		    function getRelationshipsResult(response) {
		        var arr = JSON.parse(response);
		        var i;
		        for (i = 0; i < arr.length; i++) {
		            $('#relationship').append($('<option>', {
		                value: arr[i].relationshipid,
		                text: arr[i].description,
		            }));
		        }
		        $("relationship").val("");
		    }
			
    		//open the dialog to display r/s for user to choose
		    function friendswall() {
		        window.location = "#relationshipdialog";
		    }*/
		  
	
		    
    		
		    function getAllItem() {
		        var xmlhttp = new XMLHttpRequest();
		        var url = serverURL() + "/listitemsbyuser.php";
		            url += "?userid=" + localStorage.getItem("userid") + "&boughtStatus=-1";
		     
		        xmlhttp.onreadystatechange = function() {
		            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                viewitemresult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
		    
		    function getNotBought() {
		        var xmlhttp = new XMLHttpRequest();
		        var url = serverURL() + "/listitemsbyuser.php";
		            url += "?userid=" + localStorage.getItem("userid") + "&boughtStatus=0";
		     
		        xmlhttp.onreadystatechange = function() {
		            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                viewitemresult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
		    
		    function getBought() {
		        var xmlhttp = new XMLHttpRequest();
		        var url = serverURL() + "/listitemsbyuser.php";
		            url += "?userid=" + localStorage.getItem("userid") + "&boughtStatus=1";
		     
		        xmlhttp.onreadystatechange = function() {
		            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                viewitemresult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
		    
		    function viewitemresult(response) {
		        var arr = JSON.parse(response);
		        var i;
		        $("#wallcontentset").empty();
		        
		        for (i = 0; i < arr.length; i++) {
		        	var image = "<img src='" + serverURL() + "/images/" + arr[i].imagefile + "' style='float:left;width:120px;height:70px;'>";
		        		//$("#myimg").attr("src", serverURL() + "/images/" + arr[i].imagefile);
		        	if (arr[i].userID_friend == ""){
		        		var status = "Buy For Me!"
		        	}
		        	else {var status = "Bought!";}
		        	$("#wallcontentset").append("<p>" + image + "<b>" + arr[i].itemName + "<br>" + arr[i].price + "<br>" + status + "</b></p><hr>");
		        }
		       
		    }
		   
		    
		    
    		//executes when the user presses [Shout!]
		  /*  function writewall() {
    			//prepare to make a call to the savenewwallpost.php service
		        var xmlhttp = new XMLHttpRequest();
    			
    			//form the URL to call e.g
    			//http://1505874f.projectsbit.org/friendszone/savenewwallpost.php?userid=jimmy&shout=hello
		        var url = serverURL() + "/savenewwallpost.php";
		        url += "?userid=" + localStorage.getItem("userid") +
		            "&shout=" + $("#shout").val();
		        
		        //what did the server return?
		        xmlhttp.onreadystatechange = function() {
		            //server returns 4 and 200. success!
		        	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                //execute writeWallResult()
		        		writeWallResult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
			
    		//executes on successful server call
		    function writeWallResult(response) {
    			//so what did savenewwallpost.php return?
		        var arr = JSON.parse(response);
    			
    			//it says [{"result":1}]
		        if (arr[0].result == 1) {
		        	//clear the shout box, since you shouted already
		            $("#shout").val("");
		            mywall();
		        } else {
		        	//it says [{"result":0}]
		        	//say "update fail"
		            alert("Update Fail");
		        }
		    }*/
    		
		   /* function mywall() {
		        var xmlhttp = new XMLHttpRequest();
		        var url = serverURL() + "/viewwall.php";
		        url += "?userid=" + localStorage.getItem("userid") + "&relationshipid=&view=me";
		        xmlhttp.onreadystatechange = function() {
		            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		                mywallresult(xmlhttp.responseText);
		            }
		        }
		        xmlhttp.open("GET", url, true);
		        xmlhttp.send();
		    }
		
		    function mywallresult(response) {
		        var arr = JSON.parse(response);
		        var i;
		        $("#wallcontentset").empty();
		        for (i = 0; i < arr.length; i++) {
		            $("#wallcontentset").append("<b>" +
		                arr[i].timeofposting + "</b><br/>" + arr[i].message + "<hr>");
		        }
		    }*/
		    
		    //executes mywall() to display the user's wall post
		    //this runs when the me.html page loads
		    getAllItem();		
    </script>
</head>

<body>
    <div style="color:#EEAA66" data-role="page" id="mainpage">
        <div style="color:#44CCBB" data-role="header">
            <h1>BuyForMe</h1>
            <a href="#" onclick="home()" class="ui-btn ui-icon-home ui-btn-icon-left">Home</a>
            <a href="#" onclick="logout()" data-icon="power" class="ui-btn-right">Logout</a>
        </div>
        
		<div data-role="navbar">
            <ul>
                <li><a href="#" onclick="topup()" data-icon="check">Top Up</a></li>
                <li><a href="#" onclick="profilePage()" data-icon="user">Profile</a></li>
                <li><a href="#" onclick="friends()" data-icon="heart">Friends</a></li>
				<li><a href="#" onclick="buyForMe()" data-icon="shop">Buy For Me</a></li>
            </ul>
			<a href="#" onclick="getAllItem()" class="ui-btn ui-btn-inline ui-mini ui-icon-comment ui-btn-icon-left">All</a>
			<a href="#" onclick="getNotBought()" class="ui-btn ui-btn-inline ui-mini ui-icon-comment ui-btn-icon-left">Buy For Me</a>
			<a href="#" onclick="getBought()" class="ui-btn ui-btn-inline ui-mini ui-icon-comment ui-btn-icon-left">Bought</a>

        </div> 
        
		<div data-role="content" class="ui-content" id="wallcontentset">
			
		</div>
		
		
		<div data-role="main" class="ui-content">
			
        </div>
		
	</div>
</body>

</html>